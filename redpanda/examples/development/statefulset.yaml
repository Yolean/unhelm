apiVersion: apps/v1
kind: StatefulSet
metadata:
  annotations:
    banzaicloud.com/last-applied: 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
  creationTimestamp: "2022-05-14T05:18:23Z"
  generation: 1
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: redpanda-operator
    app.kubernetes.io/name: redpanda
    app.kubernetes.io/part-of: redpanda
  name: redpanda
  namespace: redpanda-example
  ownerReferences:
  - apiVersion: redpanda.vectorized.io/v1alpha1
    blockOwnerDeletion: true
    controller: true
    kind: Cluster
    name: redpanda
    uid: e18f140f-591e-4481-9758-a9a61f834f15
  resourceVersion: "1158"
  uid: d79917fc-92d7-4e06-8d01-348e3285c849
spec:
  podManagementPolicy: Parallel
  replicas: 3
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        redpanda.vectorized.io/configmap-hash: b12823d9058ec86ef3ae14da7dddda4f
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: redpanda
      namespace: redpanda-example
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchLabels:
                  app.kubernetes.io/component: redpanda
                  app.kubernetes.io/instance: redpanda
                  app.kubernetes.io/name: redpanda
              namespaces:
              - redpanda-example
              topologyKey: kubernetes.io/hostname
            weight: 100
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            namespaces:
            - redpanda-example
            topologyKey: kubernetes.io/hostname
      containers:
      - args:
        - redpanda
        - start
        - --check=false
        - --advertise-rpc-addr=$(POD_NAME).redpanda.redpanda-example.svc.cluster.local.:33145
        - --overprovisioned
        - --kernel-page-cache=true
        - --default-log-level=debug
        - --smp=1
        - --memory=94371840
        - --reserve-memory=0M
        command:
        - /usr/bin/rpk
        env:
        - name: REDPANDA_ENVIRONMENT
          value: kubernetes
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: POD_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        image: vectorized/redpanda:latest
        imagePullPolicy: Always
        name: redpanda
        ports:
        - containerPort: 33145
          name: rpc
          protocol: TCP
        - containerPort: 9644
          name: admin
          protocol: TCP
        - containerPort: 9092
          name: kafka
          protocol: TCP
        - containerPort: 8082
          name: proxy
          protocol: TCP
        resources:
          limits:
            cpu: "1"
            memory: 1200M
          requests:
            cpu: 100m
            memory: 100Mi
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config-dir
        - mountPath: /var/lib/redpanda/data
          name: datadir
      dnsPolicy: ClusterFirst
      initContainers:
      - env:
        - name: SERVICE_FQDN
          value: redpanda.redpanda-example.svc.cluster.local.
        - name: CONFIG_SOURCE_DIR
          value: /mnt/operator
        - name: CONFIG_DESTINATION
          value: /etc/redpanda/redpanda.yaml
        - name: REDPANDA_RPC_PORT
          value: "33145"
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.nodeName
        - name: EXTERNAL_CONNECTIVITY
          value: "false"
        - name: EXTERNAL_CONNECTIVITY_SUBDOMAIN
        - name: EXTERNAL_CONNECTIVITY_ADDRESS_TYPE
        - name: HOST_PORT
        image: vectorized/configurator:v22.1.3
        imagePullPolicy: IfNotPresent
        name: redpanda-configurator
        resources:
          limits:
            cpu: "1"
            memory: 1200M
          requests:
            cpu: 100m
            memory: 100Mi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config-dir
        - mountPath: /mnt/operator
          name: configmap-dir
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext:
        fsGroup: 101
      terminationGracePeriodSeconds: 120
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - configMap:
          defaultMode: 420
          name: redpanda-base
        name: configmap-dir
      - emptyDir: {}
        name: config-dir
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: OnDelete
  volumeClaimTemplates:
  - apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: redpanda-operator
        app.kubernetes.io/name: redpanda
        app.kubernetes.io/part-of: redpanda
      name: datadir
      namespace: redpanda-example
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 1Gi
      volumeMode: Filesystem
    status:
      phase: Pending
status:
  collisionCount: 0
  currentReplicas: 3
  currentRevision: redpanda-7bcc9b857
  observedGeneration: 1
  replicas: 3
  updateRevision: redpanda-7bcc9b857
  updatedReplicas: 3
