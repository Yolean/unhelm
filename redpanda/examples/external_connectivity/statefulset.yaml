apiVersion: apps/v1
kind: StatefulSet
metadata:
  annotations:
    banzaicloud.com/last-applied: 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
  creationTimestamp: "2022-05-14T05:32:39Z"
  generation: 1
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: redpanda-operator
    app.kubernetes.io/name: redpanda
    app.kubernetes.io/part-of: redpanda
  name: redpanda
  namespace: redpanda-example
  ownerReferences:
  - apiVersion: redpanda.vectorized.io/v1alpha1
    blockOwnerDeletion: true
    controller: true
    kind: Cluster
    name: redpanda
    uid: 3e3b9bc1-42cb-40c8-bf8f-4e9ddcacdd03
  resourceVersion: "3293"
  uid: e89f4ab7-ac1a-4bc9-bc85-afe397826be8
spec:
  podManagementPolicy: Parallel
  replicas: 3
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        redpanda.vectorized.io/configmap-hash: 771c47530bd549ee1c4a78cbb3fca341
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: redpanda
      namespace: redpanda-example
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchLabels:
                  app.kubernetes.io/component: redpanda
                  app.kubernetes.io/instance: redpanda
                  app.kubernetes.io/name: redpanda
              namespaces:
              - redpanda-example
              topologyKey: kubernetes.io/hostname
            weight: 100
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            namespaces:
            - redpanda-example
            topologyKey: kubernetes.io/hostname
      containers:
      - args:
        - redpanda
        - start
        - --check=false
        - --advertise-rpc-addr=$(POD_NAME).redpanda.redpanda-example.svc.cluster.local.:33145
        - --overprovisioned
        - --kernel-page-cache=true
        - --default-log-level=debug
        - --smp=1
        - --memory=1932735283
        - --reserve-memory=0M
        command:
        - /usr/bin/rpk
        env:
        - name: REDPANDA_ENVIRONMENT
          value: kubernetes
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: POD_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        image: vectorized/redpanda:latest
        imagePullPolicy: Always
        name: redpanda
        ports:
        - containerPort: 33145
          name: rpc
          protocol: TCP
        - containerPort: 9644
          name: admin
          protocol: TCP
        - containerPort: 9092
          name: kafka
          protocol: TCP
        - containerPort: 8082
          name: proxy
          protocol: TCP
        - containerPort: 9093
          hostPort: 30789
          name: kafka-external
          protocol: TCP
        - containerPort: 8083
          hostPort: 30936
          name: proxy-external
          protocol: TCP
        - containerPort: 8081
          hostPort: 31634
          name: schema-registry
          protocol: TCP
        resources:
          limits:
            cpu: "1"
            memory: 2Gi
          requests:
            cpu: "1"
            memory: 2Gi
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config-dir
        - mountPath: /var/lib/redpanda/data
          name: datadir
      dnsPolicy: ClusterFirst
      initContainers:
      - env:
        - name: SERVICE_FQDN
          value: redpanda.redpanda-example.svc.cluster.local.
        - name: CONFIG_SOURCE_DIR
          value: /mnt/operator
        - name: CONFIG_DESTINATION
          value: /etc/redpanda/redpanda.yaml
        - name: REDPANDA_RPC_PORT
          value: "33145"
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.nodeName
        - name: EXTERNAL_CONNECTIVITY
          value: "true"
        - name: EXTERNAL_CONNECTIVITY_SUBDOMAIN
        - name: EXTERNAL_CONNECTIVITY_ADDRESS_TYPE
        - name: HOST_PORT
          value: "30789"
        - name: PROXY_HOST_PORT
          value: "30936"
        image: vectorized/configurator:v22.1.3
        imagePullPolicy: IfNotPresent
        name: redpanda-configurator
        resources:
          limits:
            cpu: "1"
            memory: 2Gi
          requests:
            cpu: "1"
            memory: 2Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config-dir
        - mountPath: /mnt/operator
          name: configmap-dir
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext:
        fsGroup: 101
      serviceAccount: redpanda
      serviceAccountName: redpanda
      terminationGracePeriodSeconds: 120
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - configMap:
          defaultMode: 420
          name: redpanda-base
        name: configmap-dir
      - emptyDir: {}
        name: config-dir
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: OnDelete
  volumeClaimTemplates:
  - apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: redpanda-operator
        app.kubernetes.io/name: redpanda
        app.kubernetes.io/part-of: redpanda
      name: datadir
      namespace: redpanda-example
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 100Gi
      volumeMode: Filesystem
    status:
      phase: Pending
status:
  collisionCount: 0
  currentReplicas: 3
  currentRevision: redpanda-5c9995fc75
  observedGeneration: 1
  replicas: 3
  updateRevision: redpanda-5c9995fc75
  updatedReplicas: 3
