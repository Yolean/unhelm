apiVersion: apps/v1
kind: StatefulSet
metadata:
  annotations:
    banzaicloud.com/last-applied: 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
  creationTimestamp: "2022-05-14T05:32:27Z"
  generation: 1
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: redpanda-operator
    app.kubernetes.io/name: redpanda
    app.kubernetes.io/part-of: redpanda
  name: redpanda
  namespace: redpanda-example
  ownerReferences:
  - apiVersion: redpanda.vectorized.io/v1alpha1
    blockOwnerDeletion: true
    controller: true
    kind: Cluster
    name: redpanda
    uid: 083980dd-5ec9-4f79-8b15-b1f617513cc1
  resourceVersion: "2971"
  uid: 14dbff6c-1a26-4519-baa4-2f8683cf4382
spec:
  podManagementPolicy: Parallel
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        redpanda.vectorized.io/configmap-hash: b70037b81889e00c8c462d2179987dcf
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: redpanda
      namespace: redpanda-example
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchLabels:
                  app.kubernetes.io/component: redpanda
                  app.kubernetes.io/instance: redpanda
                  app.kubernetes.io/name: redpanda
              namespaces:
              - redpanda-example
              topologyKey: kubernetes.io/hostname
            weight: 100
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            namespaces:
            - redpanda-example
            topologyKey: kubernetes.io/hostname
      containers:
      - args:
        - redpanda
        - start
        - --check=false
        - --advertise-rpc-addr=$(POD_NAME).redpanda.redpanda-example.svc.cluster.local.:33145
        - --overprovisioned
        - --kernel-page-cache=true
        - --default-log-level=debug
        - --smp=1
        - --memory=1080000000
        - --reserve-memory=0M
        command:
        - /usr/bin/rpk
        env:
        - name: REDPANDA_ENVIRONMENT
          value: kubernetes
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: POD_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        image: vectorized/redpanda:latest
        imagePullPolicy: Always
        name: redpanda
        ports:
        - containerPort: 33145
          name: rpc
          protocol: TCP
        - containerPort: 9644
          name: admin
          protocol: TCP
        - containerPort: 9092
          name: kafka
          protocol: TCP
        - containerPort: 8082
          name: proxy
          protocol: TCP
        resources:
          limits:
            cpu: "1"
            memory: 1200M
          requests:
            cpu: "1"
            memory: 1200M
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config-dir
        - mountPath: /etc/tls/certs
          name: tlscert
        - mountPath: /etc/tls/certs/admin
          name: tlsadmincert
        - mountPath: /etc/tls/certs/pandaproxy
          name: tlspandaproxycert
        - mountPath: /etc/tls/certs/schema-registry
          name: tlsschemaregistrycert
        - mountPath: /var/lib/redpanda/data
          name: datadir
      dnsPolicy: ClusterFirst
      initContainers:
      - env:
        - name: SERVICE_FQDN
          value: redpanda.redpanda-example.svc.cluster.local.
        - name: CONFIG_SOURCE_DIR
          value: /mnt/operator
        - name: CONFIG_DESTINATION
          value: /etc/redpanda/redpanda.yaml
        - name: REDPANDA_RPC_PORT
          value: "33145"
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.nodeName
        - name: EXTERNAL_CONNECTIVITY
          value: "false"
        - name: EXTERNAL_CONNECTIVITY_SUBDOMAIN
        - name: EXTERNAL_CONNECTIVITY_ADDRESS_TYPE
        - name: HOST_PORT
        image: vectorized/configurator:v22.1.3
        imagePullPolicy: IfNotPresent
        name: redpanda-configurator
        resources:
          limits:
            cpu: "1"
            memory: 1200M
          requests:
            cpu: "1"
            memory: 1200M
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config-dir
        - mountPath: /mnt/operator
          name: configmap-dir
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext:
        fsGroup: 101
      terminationGracePeriodSeconds: 120
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - configMap:
          defaultMode: 420
          name: redpanda-base
        name: configmap-dir
      - emptyDir: {}
        name: config-dir
      - name: tlscert
        secret:
          defaultMode: 420
          items:
          - key: tls.key
            path: tls.key
          - key: tls.crt
            path: tls.crt
          secretName: redpanda-redpanda
      - name: tlsadmincert
        secret:
          defaultMode: 420
          items:
          - key: tls.key
            path: tls.key
          - key: tls.crt
            path: tls.crt
          secretName: redpanda-admin-api-node
      - name: tlspandaproxycert
        secret:
          defaultMode: 420
          items:
          - key: tls.key
            path: tls.key
          - key: tls.crt
            path: tls.crt
          secretName: redpanda-proxy-api-node
      - name: tlsschemaregistrycert
        secret:
          defaultMode: 420
          items:
          - key: tls.key
            path: tls.key
          - key: tls.crt
            path: tls.crt
          secretName: redpanda-schema-registry-node
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: OnDelete
  volumeClaimTemplates:
  - apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: redpanda-operator
        app.kubernetes.io/name: redpanda
        app.kubernetes.io/part-of: redpanda
      name: datadir
      namespace: redpanda-example
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 100Gi
      volumeMode: Filesystem
    status:
      phase: Pending
status:
  collisionCount: 0
  currentReplicas: 1
  currentRevision: redpanda-8858f4bb5
  observedGeneration: 1
  replicas: 1
  updateRevision: redpanda-8858f4bb5
  updatedReplicas: 1
